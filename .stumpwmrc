;;; -*- lisp -*-
;;; #Date#: 9 Novembre 2015 - lid's stumpwmrc

(in-package :stumpwm)

;; swank requirement for stumpwm REPL
(require :swank)

;; function to load the swank server
(defun stump-load-swank () 
  "Initializing swank server"
  (swank-loader:init)
  (swank:create-server :port 4005
                       :style swank:*communication-style*
                       :dont-close t))

;; command to launch the swank server from stumpwm
(defcommand lss () ()
  (stump-load-swank))

(set-font "-*-terminus-medium-r-*-*-*-*-*-*-*-*-iso8859-15")
(set-normal-gravity :center)
(set-fg-color "#101010")
(set-bg-color "#f7f7f7")
(set-border-color "#101010")
(set-focus-color "#ff1111")
(set-unfocus-color   "#f7f7f7")
(set-win-bg-color    "#f7f7f7")
(setf *colors* (list "#464646"          ; 0 black
                     "#7c7c7c"          ; 1 red
                     "#8e8e8e"          ; 2 green
                     "#a0a0a0"          ; 3 yellow
                     "#686868"          ; 4 blue
                     "#747474"          ; 5 magenta
                     "#868686"          ; 6 cyan
                     "#b9b9b9"          ; 7 white
                     "#525252"          ; 8 personal
                     "#f7f7f7"))        ; 9 personal
(update-color-map (current-screen))
(set-msg-border-width 7)
(set-frame-outline-width 0)
(setf *maxsize-border-width* 4)
(setf *transient-border-width* 3)
(setf *normal-border-width* 3)
(setf *window-border-style* :thin)
(setf *message-window-gravity* :center)
(setf *input-window-gravity* :center)
(setf *mouse-focus-policy* :click)
(define-key *root-map* (kbd "c") "exec urxvt")

;; I need my conky friend

(defvar *conky-command*
  "cat /tmp/bat.txt")

;; modeline

(setf *screen-mode-line-format*
      (list "^b%g :: %W ::^B^8 %u^> %d :: "
            '(:eval (run-shell-command *conky-command* t))))

(setf *mode-line-timeout* 2)
(setf *mode-line-background-color* "#f7f7f7")
(setf *mode-line-foreground-color* "#101010")
(setf *mode-line-border-color* "#101010")
(setf *mode-line-position* :bottom)

;; config top-map
(define-key *top-map* (kbd "M-h") "move-focus left")
(define-key *top-map* (kbd "M-l") "move-focus right")
(define-key *top-map* (kbd "M-j") "move-focus down")
(define-key *top-map* (kbd "M-k") "move-focus up")
(define-key *top-map* (kbd "M-H") "move-window left")
(define-key *top-map* (kbd "M-L") "move-window right")
(define-key *top-map* (kbd "M-J") "move-window down")
(define-key *top-map* (kbd "M-K") "move-window up")
(define-key *top-map* (kbd "M-s") "vsplit")
(define-key *top-map* (kbd "M-f") "hsplit")
(define-key *top-map* (kbd "M-i") "next-in-frame")
(define-key *top-map* (kbd "M-I") "prev-in-frame")
(define-key *top-map* (kbd "M-e") "fselect")
(define-key *top-map* (kbd "C-M-h") "exchange-direction left")
(define-key *top-map* (kbd "C-M-l") "exchange-direction right")
(define-key *top-map* (kbd "C-M-j") "exchange-direction down")
(define-key *top-map* (kbd "C-M-k") "exchange-direction up")
(define-key *top-map* (kbd "M-v") "show-window-properties")
(define-key *top-map* (kbd "M-V") "info")
(define-key *top-map* (kbd "M-!") "exec")
(define-key *top-map* (kbd "M-p") "exec rofi -show run -font 'Terminus 12' -fg '#101010' -bg '#f7f7f7' -lines '20' -columns '3' -hlfg '#f7f7f7' -hlbg '#101010' -bc '#474737' -bw '3'")
(define-key *top-map* (kbd "M-;") "eval")
(define-key *top-map* (kbd "M-:") "colon")
(define-key *top-map* (kbd "M-U") "windowlist")
(define-key *top-map* (kbd "M-u") "next-urgent")
(define-key *top-map* (kbd "M-w") "frame-windowlist")
(define-key *top-map* (kbd "M-A") "time")
(define-key *top-map* (kbd "M-a") "title")
(define-key *top-map* (kbd "M-&") "meta M-f")
(define-key *top-map* (kbd "M-g") "vgroups")
(define-key *top-map* (kbd "M-n") "gnext")
(define-key *top-map* (kbd "C-M-n") "gnext-with-window")
(define-key *top-map* (kbd "M-N") "gprev")
(define-key *top-map* (kbd "C-M-N") "gprev-with-window")
(define-key *top-map* (kbd "M-t") "mode-line")
(define-key *top-map* (kbd "M-r") "iresize")
(define-key *top-map* (kbd "M-b") "banish")
(define-key *top-map* (kbd "M-z") "remove")
(define-key *top-map* (kbd "M-Return") "exec urxvt")
(define-key *top-map* (kbd "M-m") "gselect")
(define-key *top-map* (kbd "C-M-m") "pull-marked")
(define-key *top-map* (kbd "M-o") "fullscreen")
(define-key *top-map* (kbd "M-y") "exec /home/lidstah/bin/mlock.sh")

;; config root-map
(define-key *root-map* (kbd "h") "move-focus left")
(define-key *root-map* (kbd "l") "move-focus right")
(define-key *root-map* (kbd "j") "move-focus down")
(define-key *root-map* (kbd "k") "move-focus up")
(define-key *root-map* (kbd "H") "move-window left")
(define-key *root-map* (kbd "L") "move-window right")
(define-key *root-map* (kbd "J") "move-window down")
(define-key *root-map* (kbd "K") "move-window up")
(define-key *root-map* (kbd "s") "vsplit")
(define-key *root-map* (kbd "f") "hsplit")
(define-key *root-map* (kbd "i") "next-in-frame")
(define-key *root-map* (kbd "F12") "other-in-frame")
(define-key *root-map* (kbd "I") "prev-in-frame")
(define-key *root-map* (kbd "e") "pull-tag vim")
(define-key *root-map* (kbd "C-h") "exchange-direction left")
(define-key *root-map* (kbd "C-l") "exchange-direction right")
(define-key *root-map* (kbd "C-j") "exchange-direction down")
(define-key *root-map* (kbd "C-k") "exchange-direction up")
(define-key *root-map* (kbd "v") "show-window-properties")
(define-key *root-map* (kbd "V") "info")
(define-key *root-map* (kbd "!") "exec")
(define-key *root-map* (kbd "p") "exec rofi -show run -font 'Terminus 12' -fg '#101010' -bg '#f7f7f7' -lines '20' -columns '3' -hlfg '#f7f7f7' -hlbg '#101010' -bc '#474737' -bw '3'")
(define-key *root-map* (kbd ";") "eval")
(define-key *root-map* (kbd ":") "colon")
(define-key *root-map* (kbd "y") "windowlist")
(define-key *root-map* (kbd "u") "next-urgent")
(define-key *root-map* (kbd "w") "frame-windowlist")
(define-key *root-map* (kbd "A") "time")
(define-key *root-map* (kbd "U") "title")
(define-key *root-map* (kbd "n") "gnext")
(define-key *root-map* (kbd "C-n") "gnext-with-window")
(define-key *root-map* (kbd "N") "gprev")
(define-key *root-map* (kbd "C-N") "gprev-with-window")
(define-key *root-map* (kbd "t") "mode-line")
(define-key *root-map* (kbd "r") "iresize")
(define-key *root-map* (kbd "b") "banish")
(define-key *root-map* (kbd "B") "my_little_relwarp")
(define-key *root-map* (kbd "z") "remove")
(define-key *root-map* (kbd "Return") "exec urxvt")
(define-key *root-map* (kbd "m") "gselect")
(define-key *root-map* (kbd "M") "tag-window")
(define-key *root-map* (kbd "C-m") "pull-marked")
(define-key *root-map* (kbd "O") "fselect")
(define-key *root-map* (kbd "o") "fullscreen")
(define-key *root-map* (kbd "d") "delete-window")
(define-key *root-map* (kbd "Y") "exec /home/lidstah/bin/mlock.sh")

;; resize remodelling
(setf *resize-increment* 40)
(defun update-resize-map ()
"on refait le mapping du mode iresize avec un incrément supérieur"
  (let ((m (setf *resize-map* (make-sparse-keymap))))
    (let ((i *resize-increment*))
    (labels ((dk (m k c) (define-key m k (format nil c i))))
      (dk m (kbd "k") "resize 0 -~D")
      (dk m (kbd "j") "resize 0 ~D")
      (dk m (kbd "h") "resize -~D 0")
      (dk m (kbd "l") "resize ~D 0")
      (dk m (kbd "RET") "exit-iresize")
      (dk m (kbd "ESC") "abort-iresize")
    M)))) (update-resize-map)
		
(setf (group-name (first (screen-groups (current-screen)))) "pcp")
(run-commands "gnewbg web" "gnewbg irc" "gnewbg ssh" "gnewbg oth")
(run-shell-command "xsetroot -cursor_name left_ptr")
(run-shell-command "feh --bg-center bg.png")
(run-shell-command "xmodmap -e 'clear mod4'")
(run-shell-command "xmodmap -e 'keycode 133 = F12'")
(set-prefix-key (kbd "F12"))
;;; vim:filetype=lisp: 
